<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kikai Mission Control</title>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --bg: #0a0a0a;
  --surface: #111111;
  --surface2: #161616;
  --surface3: #1c1c1c;
  --border: #1e1e1e;
  --border2: #272727;
  --text: #e5e5e5;
  --text2: #aaa;
  --dim: #666;
  --dim2: #888;
  --accent: #00D9FF;
  --green: #39FF14;
  --yellow: #FFD700;
  --red: #ff4444;
  --orange: #ff8c00;
  --purple: #a78bfa;
  --pink: #f472b6;
  --sidebar-w: 200px;
}

body {
  font-family: 'Inter', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LAYOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.app {
  display: flex;
  flex: 1;
  min-height: 100vh;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIDEBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sidebar {
  width: var(--sidebar-w);
  background: var(--surface);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  position: fixed;
  top: 0;
  left: 0;
  bottom: 0;
  z-index: 20;
  overflow-y: auto;
}

.sidebar-logo {
  padding: 20px 16px 16px;
  border-bottom: 1px solid var(--border);
}

.sidebar-logo-name {
  font-size: 15px;
  font-weight: 800;
  letter-spacing: -0.3px;
  line-height: 1;
}

.sidebar-logo-name span { color: var(--accent); }

.sidebar-logo-sub {
  font-size: 10px;
  color: var(--dim2);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.8px;
  margin-top: 4px;
}

.sidebar-nav {
  padding: 12px 8px;
  flex: 1;
}

.nav-item {
  display: flex;
  align-items: center;
  gap: 9px;
  padding: 8px 10px;
  border-radius: 7px;
  font-size: 13px;
  font-weight: 500;
  color: var(--dim2);
  cursor: pointer;
  transition: background 0.12s, color 0.12s;
  user-select: none;
  margin-bottom: 2px;
  position: relative;
}

.nav-item:hover { background: var(--surface2); color: var(--text2); }

.nav-item.active {
  background: rgba(0, 217, 255, 0.08);
  color: var(--accent);
}

.nav-icon { font-size: 14px; width: 18px; text-align: center; flex-shrink: 0; }

.nav-badge {
  margin-left: auto;
  font-size: 10px;
  font-weight: 700;
  background: rgba(255, 68, 68, 0.15);
  color: var(--red);
  border-radius: 8px;
  padding: 1px 6px;
  min-width: 18px;
  text-align: center;
}

.sidebar-footer {
  padding: 12px 16px;
  border-top: 1px solid var(--border);
}

.sidebar-updated {
  font-size: 10px;
  color: var(--dim);
  display: flex;
  align-items: center;
  gap: 5px;
}

.live-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: var(--green);
  flex-shrink: 0;
  animation: livepulse 2s infinite;
}

@keyframes livepulse { 0%,100%{opacity:1} 50%{opacity:0.3} }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN CONTENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.main {
  margin-left: var(--sidebar-w);
  flex: 1;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

.main-header {
  padding: 18px 28px 16px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: var(--surface);
  position: sticky;
  top: 0;
  z-index: 10;
}

.main-title {
  font-size: 17px;
  font-weight: 700;
  letter-spacing: -0.3px;
}

.main-subtitle {
  font-size: 12px;
  color: var(--dim2);
  margin-top: 1px;
}

.content {
  padding: 24px 28px 60px;
  max-width: 960px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION VISIBILITY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.section { display: none; }
.section.active { display: block; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROJECT CARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.project-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  margin-bottom: 16px;
  overflow: hidden;
  transition: border-color 0.15s;
}

.project-card:hover { border-color: var(--border2); }

.project-header {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 16px 20px;
  cursor: pointer;
  user-select: none;
  transition: background 0.12s;
}

.project-header:hover { background: var(--surface2); }

.project-color-bar {
  width: 4px;
  height: 36px;
  border-radius: 2px;
  flex-shrink: 0;
}

.project-info { flex: 1; min-width: 0; }

.project-name {
  font-size: 15px;
  font-weight: 700;
  letter-spacing: -0.2px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.project-desc {
  font-size: 12px;
  color: var(--dim2);
  margin-top: 3px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.project-badges {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-shrink: 0;
}

.status-pill {
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.6px;
  padding: 3px 8px;
  border-radius: 5px;
}

.pill-active   { background: rgba(0,217,255,0.12);  color: var(--accent); }
.pill-paused   { background: rgba(255,215,0,0.12);  color: var(--yellow); }
.pill-building { background: rgba(244,114,182,0.12);color: var(--pink);   }
.pill-backlog  { background: rgba(255,255,255,0.05);color: var(--dim2);   }

.priority-tag {
  font-size: 10px;
  color: var(--dim);
  font-weight: 600;
}

.project-chevron {
  font-size: 11px;
  color: var(--dim);
  flex-shrink: 0;
  transition: transform 0.2s;
}

.project-card.collapsed .project-chevron { transform: rotate(-90deg); }

.project-body {
  border-top: 1px solid var(--border);
  padding: 0 20px 20px;
}

.project-card.collapsed .project-body { display: none; }

/* Tasks */
.section-label {
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.8px;
  color: var(--dim);
  margin: 16px 0 8px;
}

.task-row {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  padding: 10px 12px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 8px;
  margin-bottom: 6px;
  cursor: pointer;
  transition: border-color 0.12s, background 0.12s;
}

.task-row:hover {
  border-color: var(--border2);
  background: var(--surface3);
}

.task-status-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
  margin-top: 5px;
}

.dot-active   { background: var(--accent); box-shadow: 0 0 6px rgba(0,217,255,0.5); }
.dot-blocked  { background: var(--red); }
.dot-paused   { background: var(--yellow); }
.dot-queued   { background: var(--dim); }
.dot-done     { background: var(--green); }

.task-body { flex: 1; min-width: 0; }

.task-title {
  font-size: 13px;
  font-weight: 600;
  line-height: 1.3;
  color: var(--text);
}

.task-last {
  font-size: 11px;
  color: var(--dim2);
  margin-top: 3px;
  line-height: 1.4;
}

.task-next {
  font-size: 11px;
  color: var(--text2);
  margin-top: 4px;
  font-weight: 500;
}

.task-next::before { content: 'â†’ '; color: var(--dim); }

.task-owner {
  font-size: 12px;
  flex-shrink: 0;
  color: var(--dim2);
}

/* Needs To Do checklist */
.needs-list { margin-top: 4px; }

.needs-item {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  padding: 8px 0;
  border-bottom: 1px solid var(--border);
  font-size: 12px;
  color: var(--text2);
  line-height: 1.5;
}

.needs-item:last-child { border-bottom: none; }

.needs-icon { flex-shrink: 0; font-size: 13px; margin-top: 0px; }

.needs-text { flex: 1; }

.needs-urgent { color: var(--red); }
.needs-wjp-tag {
  flex-shrink: 0;
  font-size: 9px;
  font-weight: 700;
  background: rgba(255,68,68,0.1);
  color: var(--red);
  padding: 2px 5px;
  border-radius: 3px;
  text-transform: uppercase;
  letter-spacing: 0.3px;
}

.empty-list {
  padding: 12px 0;
  font-size: 12px;
  color: var(--dim);
  font-style: italic;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AGENT MONITOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.agents-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  margin-bottom: 20px;
}

.agent-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 20px;
  transition: border-color 0.15s;
}

.agent-card.agent-active { border-color: rgba(0,217,255,0.2); }
.agent-card.agent-idle   { border-color: var(--border); }
.agent-card.agent-offline{ border-color: rgba(255,68,68,0.15); }

.agent-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 16px;
}

.agent-emoji { font-size: 24px; }

.agent-name-block { flex: 1; }

.agent-name {
  font-size: 15px;
  font-weight: 700;
  letter-spacing: -0.2px;
}

.agent-model {
  font-size: 11px;
  color: var(--dim2);
  margin-top: 2px;
  font-family: 'SF Mono', 'Fira Code', monospace;
}

.agent-status-badge {
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  padding: 3px 8px;
  border-radius: 5px;
}

.badge-active   { background: rgba(0,217,255,0.12); color: var(--accent); }
.badge-idle     { background: rgba(255,215,0,0.12);  color: var(--yellow); }
.badge-offline  { background: rgba(255,68,68,0.12);  color: var(--red); }
.badge-ssh      { background: rgba(255,140,0,0.12);  color: var(--orange); }
.badge-ratelimited { background: rgba(255,68,68,0.2); color: var(--red); }

.agent-working-on {
  font-size: 12px;
  color: var(--text2);
  margin-bottom: 14px;
  padding: 8px 10px;
  background: var(--surface2);
  border-radius: 6px;
  line-height: 1.4;
}

.agent-working-label {
  font-size: 9px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.6px;
  color: var(--dim);
  margin-bottom: 3px;
}

.agent-working-text {
  font-size: 12px;
  color: var(--text);
  font-weight: 500;
}

/* Context bar */
.context-bar-wrap { margin-bottom: 14px; }

.context-bar-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 5px;
}

.context-bar-label {
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.6px;
  color: var(--dim);
}

.context-bar-pct {
  font-size: 12px;
  font-weight: 700;
  font-family: 'SF Mono', 'Fira Code', monospace;
}

.context-bar-bg {
  height: 5px;
  background: var(--border2);
  border-radius: 3px;
  overflow: hidden;
}

.context-bar-fill {
  height: 100%;
  border-radius: 3px;
  transition: width 0.6s ease;
}

.agent-stats {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
}

.agent-stat {
  background: var(--surface2);
  border-radius: 6px;
  padding: 8px 10px;
}

.agent-stat-label {
  font-size: 9px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.6px;
  color: var(--dim);
  margin-bottom: 3px;
}

.agent-stat-val {
  font-size: 13px;
  font-weight: 600;
  color: var(--text);
  font-family: 'SF Mono', 'Fira Code', monospace;
}

.agent-stat-val.muted { color: var(--dim2); font-family: inherit; font-size: 12px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INTEL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.intel-list { display: flex; flex-direction: column; gap: 8px; }

.intel-item {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  padding: 12px 14px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px;
  font-size: 13px;
  color: var(--text2);
  line-height: 1.5;
}

.intel-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: var(--accent);
  flex-shrink: 0;
  margin-top: 5px;
}

.intel-time {
  font-size: 10px;
  color: var(--dim);
  margin-top: 4px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FILES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.files-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
  gap: 10px;
}

.file-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 14px;
  cursor: pointer;
  transition: border-color 0.12s, background 0.12s;
}

.file-card:hover {
  border-color: var(--border2);
  background: var(--surface2);
}

.file-card-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 6px;
}

.file-icon { font-size: 16px; }

.file-name {
  font-size: 12px;
  font-weight: 700;
  color: var(--text2);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.file-preview {
  font-size: 12px;
  color: var(--dim2);
  line-height: 1.4;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.file-path {
  font-size: 10px;
  color: var(--dim);
  margin-top: 6px;
  font-family: 'SF Mono', 'Fira Code', monospace;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NEEDS WJP SUMMARY BANNER (projects page)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.wjp-banner {
  background: rgba(255,68,68,0.06);
  border: 1px solid rgba(255,68,68,0.15);
  border-radius: 10px;
  padding: 14px 18px;
  margin-bottom: 20px;
  cursor: pointer;
  transition: background 0.12s;
}

.wjp-banner:hover { background: rgba(255,68,68,0.09); }

.wjp-banner-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
}

.wjp-banner-title {
  font-size: 12px;
  font-weight: 700;
  color: var(--red);
  text-transform: uppercase;
  letter-spacing: 0.6px;
}

.wjp-banner-items { display: flex; flex-direction: column; gap: 4px; }

.wjp-banner-item {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 12px;
  color: var(--text2);
}

.wjp-urgency-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  flex-shrink: 0;
}

.u-critical { background: var(--red); }
.u-high     { background: var(--orange); }
.u-medium   { background: var(--yellow); }
.u-low      { background: var(--dim); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.8);
  z-index: 100;
  display: none;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.overlay.open { display: flex; animation: fadein 0.15s ease; }

@keyframes fadein { from{opacity:0} to{opacity:1} }

.modal {
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: 12px;
  width: 100%;
  max-width: 600px;
  max-height: 86vh;
  display: flex;
  flex-direction: column;
  animation: slidein 0.18s ease;
}

@keyframes slidein {
  from { opacity:0; transform: translateY(10px) scale(0.98); }
  to   { opacity:1; transform: translateY(0) scale(1); }
}

.modal-head {
  padding: 18px 22px 14px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: flex-start;
  gap: 10px;
}

.modal-title {
  font-size: 16px;
  font-weight: 700;
  flex: 1;
  line-height: 1.3;
}

.modal-x {
  width: 28px;
  height: 28px;
  border: none;
  background: var(--surface2);
  color: var(--dim2);
  border-radius: 6px;
  cursor: pointer;
  font-size: 15px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  transition: background 0.12s, color 0.12s;
}

.modal-x:hover { background: var(--border2); color: var(--text); }

.modal-body {
  padding: 18px 22px;
  overflow-y: auto;
  flex: 1;
  line-height: 1.6;
}

/* Markdown rendering */
.md-content { font-size: 13px; color: var(--text2); }
.md-content h1 { font-size:16px; color:var(--text); margin-bottom:12px; }
.md-content h2 { font-size:14px; color:var(--text); margin:14px 0 8px; }
.md-content h3 { font-size:13px; color:var(--text2); margin:12px 0 6px; }
.md-content p  { margin-bottom:10px; }
.md-content ul,
.md-content ol { padding-left:18px; margin-bottom:10px; }
.md-content li { margin-bottom:4px; }
.md-content code { background:var(--surface2); padding:1px 5px; border-radius:4px; font-size:12px; font-family: 'SF Mono','Fira Code',monospace; }
.md-content pre { background:var(--surface2); border-radius:6px; padding:12px; overflow-x:auto; margin-bottom:10px; }
.md-content pre code { background:none; padding:0; }
.md-content strong { color:var(--text); font-weight:600; }
.md-content a { color:var(--accent); text-decoration:none; }
.md-content blockquote { border-left:3px solid var(--border2); padding-left:12px; color:var(--dim2); margin:10px 0; }
.md-content table { width:100%; border-collapse:collapse; font-size:12px; margin-bottom:10px; }
.md-content th { padding:6px 8px; border-bottom:1px solid var(--border2); text-align:left; color:var(--dim2); font-weight:600; }
.md-content td { padding:6px 8px; border-bottom:1px solid var(--border); }

/* Detail modal sections */
.detail-section { margin-bottom:16px; }
.detail-label { font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:0.7px; color:var(--dim); margin-bottom:5px; }
.detail-value { font-size:13px; color:var(--text); line-height:1.5; }
.detail-value.dim { color:var(--dim2); }
.detail-tags { display:flex; flex-wrap:wrap; gap:6px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CRON FOOTER (collapsible)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cron-footer {
  margin-top: 32px;
  border: 1px solid var(--border);
  border-radius: 8px;
  overflow: hidden;
}

.cron-footer-toggle {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 14px;
  cursor: pointer;
  font-size: 11px;
  color: var(--dim);
  user-select: none;
  transition: background 0.12s;
}

.cron-footer-toggle:hover { background: var(--surface2); }

.cron-footer-body {
  display: none;
  padding: 12px 14px;
  border-top: 1px solid var(--border);
  font-size: 11px;
  color: var(--dim2);
  gap: 16px;
  flex-wrap: wrap;
}

.cron-footer-body.open { display: flex; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE â€” mobile
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 768px) {
  :root { --sidebar-w: 0px; }

  .sidebar { display: none; }

  .main { margin-left: 0; }

  /* Bottom tab bar */
  .mobile-nav {
    display: flex;
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: var(--surface);
    border-top: 1px solid var(--border);
    z-index: 20;
    padding: 4px 0 env(safe-area-inset-bottom, 4px);
  }

  .mobile-nav-item {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
    padding: 6px 0;
    font-size: 9px;
    font-weight: 600;
    color: var(--dim);
    cursor: pointer;
    text-transform: uppercase;
    letter-spacing: 0.4px;
    transition: color 0.12s;
    user-select: none;
  }

  .mobile-nav-item.active { color: var(--accent); }
  .mobile-nav-item .mobile-nav-icon { font-size: 18px; }

  .content { padding: 16px 16px 80px; }
  .main-header { padding: 14px 16px 12px; }
  .agents-grid { grid-template-columns: 1fr; }
}

@media (min-width: 769px) {
  .mobile-nav { display: none; }
}
</style>
</head>
<body>

<div class="app">

  <!-- â•â• SIDEBAR â•â• -->
  <nav class="sidebar">
    <div class="sidebar-logo">
      <div class="sidebar-logo-name">ğŸ¦Š Kikai <span>MC</span></div>
      <div class="sidebar-logo-sub">Mission Control</div>
    </div>

    <div class="sidebar-nav">
      <div class="nav-item active" data-section="projects" onclick="switchSection('projects', this)">
        <span class="nav-icon">ğŸ“‹</span> Projects
      </div>
      <div class="nav-item" data-section="agents" onclick="switchSection('agents', this)">
        <span class="nav-icon">âš¡</span> Agents
      </div>
      <div class="nav-item" data-section="intel" onclick="switchSection('intel', this)">
        <span class="nav-icon">ğŸ“¡</span> Intel
      </div>
      <div class="nav-item" data-section="files" onclick="switchSection('files', this)">
        <span class="nav-icon">ğŸ“</span> Files
      </div>
    </div>

    <div class="sidebar-footer">
      <div class="sidebar-updated">
        <div class="live-dot"></div>
        <span id="sidebar-updated">Loading...</span>
      </div>
    </div>
  </nav>

  <!-- â•â• MAIN â•â• -->
  <main class="main">

    <div class="main-header">
      <div>
        <div class="main-title" id="header-title">Projects</div>
        <div class="main-subtitle" id="header-sub">Where everything is at + what needs to happen</div>
      </div>
    </div>

    <div class="content">

      <!-- PROJECTS -->
      <div class="section active" id="section-projects">
        <!-- WJP banner populated by JS -->
        <div id="wjp-banner-container"></div>
        <div id="projects-container"></div>
        <div class="cron-footer" id="cron-footer">
          <div class="cron-footer-toggle" onclick="toggleCronFooter()">
            <span>ğŸ”§ System health</span>
            <span id="cron-footer-summary">loading...</span>
            <span id="cron-chevron">â–¾</span>
          </div>
          <div class="cron-footer-body" id="cron-footer-body"></div>
        </div>
      </div>

      <!-- AGENTS -->
      <div class="section" id="section-agents">
        <div class="agents-grid" id="agents-grid"></div>
        <p style="font-size:11px;color:var(--dim);margin-top:8px;">Refreshes every 30s Â· Context % estimated from session file size</p>
      </div>

      <!-- INTEL -->
      <div class="section" id="section-intel">
        <div class="intel-list" id="intel-list"></div>
      </div>

      <!-- FILES -->
      <div class="section" id="section-files">
        <div class="files-grid" id="files-grid"></div>
      </div>

    </div>
  </main>
</div>

<!-- MOBILE NAV -->
<div class="mobile-nav">
  <div class="mobile-nav-item active" data-section="projects" onclick="switchSection('projects', this)">
    <span class="mobile-nav-icon">ğŸ“‹</span>Projects
  </div>
  <div class="mobile-nav-item" data-section="agents" onclick="switchSection('agents', this)">
    <span class="mobile-nav-icon">âš¡</span>Agents
  </div>
  <div class="mobile-nav-item" data-section="intel" onclick="switchSection('intel', this)">
    <span class="mobile-nav-icon">ğŸ“¡</span>Intel
  </div>
  <div class="mobile-nav-item" data-section="files" onclick="switchSection('files', this)">
    <span class="mobile-nav-icon">ğŸ“</span>Files
  </div>
</div>

<!-- MODAL -->
<div class="overlay" id="overlay" onclick="closeModal(event)">
  <div class="modal" id="modal">
    <div class="modal-head">
      <div class="modal-title" id="modal-title"></div>
      <button class="modal-x" onclick="closeModal()">âœ•</button>
    </div>
    <div class="modal-body" id="modal-body"></div>
  </div>
</div>

<script>
'use strict';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONSTANTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PROJECT_COLORS = {
  'for-crypto': '#00D9FF',
  'for crypto': '#00D9FF',
  'divvvy':     '#f472b6',
  '67':         '#FFD700',
  'os':         '#a78bfa',
};

const OWNER_EMOJI = { Kikai:'ğŸ¦Š', Yama:'ğŸº', Both:'ğŸ¦ŠğŸº', WJP:'ğŸ‘¤' };
const SECTION_LABELS = {
  projects: ['Projects', 'Where everything is at + what needs to happen'],
  agents:   ['Agent Monitor', 'Live status â€” refreshes every 30s'],
  intel:    ['Intel', 'Market + project intelligence'],
  files:    ['Files', 'Key workspace files'],
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentSection = 'projects';

function switchSection(id, el) {
  // Hide all sections
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.getElementById('section-' + id).classList.add('active');

  // Update sidebar nav
  document.querySelectorAll('.sidebar .nav-item').forEach(n => n.classList.remove('active'));
  // Update mobile nav
  document.querySelectorAll('.mobile-nav-item').forEach(n => n.classList.remove('active'));
  // Mark the clicked item active (both desktop and mobile)
  document.querySelectorAll(`[data-section="${id}"]`).forEach(n => n.classList.add('active'));

  const [title, sub] = SECTION_LABELS[id] || [id, ''];
  document.getElementById('header-title').textContent = title;
  document.getElementById('header-sub').textContent = sub;
  currentSection = id;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openModal(title, bodyHTML) {
  document.getElementById('modal-title').textContent = title;
  document.getElementById('modal-body').innerHTML = bodyHTML;
  document.getElementById('overlay').classList.add('open');
}

function closeModal(e) {
  if (e && e.target !== document.getElementById('overlay')) return;
  document.getElementById('overlay').classList.remove('open');
}

document.addEventListener('keydown', e => {
  if (e.key === 'Escape') document.getElementById('overlay').classList.remove('open');
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function timeAgo(isoStr) {
  if (!isoStr) return 'â€”';
  const diff = Date.now() - new Date(isoStr).getTime();
  const m = Math.floor(diff / 60000);
  if (m < 1) return 'just now';
  if (m < 60) return m + 'm ago';
  const h = Math.floor(m / 60);
  if (h < 24) return h + 'h ago';
  return Math.floor(h / 24) + 'd ago';
}

function fmtDuration(mins) {
  if (mins == null) return 'â€”';
  if (mins < 60) return mins + 'm';
  const h = Math.floor(mins / 60), m = mins % 60;
  return m ? `${h}h ${m}m` : `${h}h`;
}

function getProjectColor(idOrName) {
  if (!idOrName) return '#888';
  const key = idOrName.toLowerCase();
  for (const [k, v] of Object.entries(PROJECT_COLORS)) {
    if (key.includes(k)) return v;
  }
  return '#888';
}

function statusDotClass(status) {
  const s = (status || '').toLowerCase();
  if (s === 'active') return 'dot-active';
  if (s === 'blocked') return 'dot-blocked';
  if (s === 'paused') return 'dot-paused';
  if (s === 'done') return 'dot-done';
  return 'dot-queued';
}

function pillClass(status) {
  const s = (status || '').toLowerCase();
  if (s === 'active') return 'pill-active';
  if (s === 'paused') return 'pill-paused';
  if (s === 'building') return 'pill-building';
  return 'pill-backlog';
}

function ctxColor(pct) {
  if (pct < 50) return '#39FF14';
  if (pct < 75) return '#FFD700';
  return '#ff4444';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER â€” PROJECTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderProjects(projects, needsWjp) {
  // WJP banner
  const bannerEl = document.getElementById('wjp-banner-container');
  if (needsWjp && needsWjp.length) {
    const urgencyOrder = { critical:0, high:1, medium:2, low:3 };
    const sorted = [...needsWjp].sort((a,b) => (urgencyOrder[a.urgency]??9)-(urgencyOrder[b.urgency]??9));
    bannerEl.innerHTML = `
      <div class="wjp-banner" onclick="switchSection('files',document.querySelector('[data-section=files]'))">
        <div class="wjp-banner-header">
          <span style="font-size:14px">ğŸ”´</span>
          <span class="wjp-banner-title">Needs WJP â€” ${sorted.length} item${sorted.length!==1?'s':''}</span>
        </div>
        <div class="wjp-banner-items">
          ${sorted.map(item => `
            <div class="wjp-banner-item" onclick="event.stopPropagation();openWjpModal(${safeJSON(item)})">
              <div class="wjp-urgency-dot u-${item.urgency}"></div>
              <span><strong style="color:var(--text)">${escHTML(item.title)}</strong> â€” ${escHTML(item.ask)}</span>
            </div>
          `).join('')}
        </div>
      </div>`;
  } else {
    bannerEl.innerHTML = '';
  }

  const container = document.getElementById('projects-container');
  container.innerHTML = projects.map((proj, i) => {
    const color = proj.color || getProjectColor(proj.id);
    const tasks = proj.tasks || [];
    const needs = proj.needsToDo || [];
    const priorityLabel = proj.priority <= 2 ? `Priority #${proj.priority}` : proj.priority === 3 ? 'Maintain' : 'Internal';

    return `
      <div class="project-card" id="proj-${proj.id}">
        <div class="project-header" onclick="toggleProject('${proj.id}')">
          <div class="project-color-bar" style="background:${color}"></div>
          <div class="project-info">
            <div class="project-name" style="color:${color}">
              ${escHTML(proj.name)}
            </div>
            <div class="project-desc">${escHTML(proj.description || '')}</div>
          </div>
          <div class="project-badges">
            <span class="priority-tag">${priorityLabel}</span>
            <span class="status-pill ${pillClass(proj.status)}">${escHTML(proj.status)}</span>
          </div>
          <div class="project-chevron">â–¾</div>
        </div>

        <div class="project-body">
          <!-- Tasks -->
          <div class="section-label">Tasks</div>
          ${tasks.length ? tasks.map(task => `
            <div class="task-row" onclick="openTaskModal(${safeJSON(task)}, '${escHTML(proj.name)}', '${color}')">
              <div class="task-status-dot ${statusDotClass(task.status)}"></div>
              <div class="task-body">
                <div class="task-title">${escHTML(task.title)}</div>
                <div class="task-last">${escHTML(task.lastUpdate)}</div>
                <div class="task-next">${escHTML(task.nextAction)}</div>
              </div>
              <div class="task-owner">${OWNER_EMOJI[task.owner] || 'ğŸ‘¤'}</div>
            </div>
          `).join('') : '<div class="empty-list">No active tasks</div>'}

          <!-- What we need to do -->
          <div class="section-label">What we need to do</div>
          ${needs.length ? `<div class="needs-list">${needs.map(n => `
            <div class="needs-item ${n.urgent ? 'needs-urgent' : ''}">
              <span class="needs-icon">${n.urgent ? 'ğŸ”´' : n.wjp ? 'ğŸ‘¤' : 'ğŸ¦Š'}</span>
              <span class="needs-text">${escHTML(n.text)}</span>
              ${n.wjp ? '<span class="needs-wjp-tag">WJP</span>' : ''}
            </div>
          `).join('')}</div>` : '<div class="empty-list">Nothing blocked â€” good to go</div>'}
        </div>
      </div>`;
  }).join('');
}

function toggleProject(id) {
  document.getElementById('proj-' + id).classList.toggle('collapsed');
}

function openTaskModal(task, projName, color) {
  const ownerEmoji = OWNER_EMOJI[task.owner] || 'ğŸ‘¤';
  const dotClass = statusDotClass(task.status);
  openModal(task.title, `
    <div class="detail-section">
      <div class="detail-tags">
        <span style="font-size:11px;font-weight:700;color:${color};background:${color}18;padding:3px 8px;border-radius:5px;text-transform:uppercase;letter-spacing:0.5px">${escHTML(projName)}</span>
        <span style="font-size:11px;font-weight:600;color:var(--dim2)">${ownerEmoji} ${escHTML(task.owner||'')}</span>
        <span style="font-size:10px;font-weight:700;text-transform:uppercase;padding:3px 7px;border-radius:5px;background:var(--surface2);color:var(--dim2)">${escHTML(task.status||'')}</span>
      </div>
    </div>
    <div class="detail-section">
      <div class="detail-label">Last update</div>
      <div class="detail-value">${escHTML(task.lastUpdate||'â€”')}</div>
    </div>
    <div class="detail-section">
      <div class="detail-label">Next action</div>
      <div class="detail-value">${escHTML(task.nextAction||'â€”')}</div>
    </div>
  `);
}

function openWjpModal(item) {
  const color = getProjectColor(item.project || '');
  openModal(item.title, `
    <div class="detail-section">
      <div class="detail-tags">
        <span style="font-size:11px;font-weight:700;color:${color};background:${color}18;padding:3px 8px;border-radius:5px">${escHTML(item.project||'')}</span>
        <span style="font-size:10px;font-weight:700;padding:3px 8px;border-radius:5px;background:rgba(255,68,68,0.12);color:var(--red);text-transform:uppercase">${escHTML(item.urgency||'')}</span>
      </div>
    </div>
    <div class="detail-section">
      <div class="detail-label">What WJP needs to do</div>
      <div class="detail-value" style="font-weight:600">${escHTML(item.ask||'')}</div>
    </div>
    ${item.impact ? `<div class="detail-section">
      <div class="detail-label">Impact if not done</div>
      <div class="detail-value dim">${escHTML(item.impact)}</div>
    </div>` : ''}
    <div class="detail-section">
      <div class="detail-label">Added</div>
      <div class="detail-value dim">${timeAgo(item.updatedAt)}</div>
    </div>
  `);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER â€” AGENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderAgents(agents) {
  const grid = document.getElementById('agents-grid');
  const agentList = [
    { key: 'kikai', name: 'Kikai', emoji: 'ğŸ¦Š' },
    { key: 'yama',  name: 'Yama',  emoji: 'ğŸº' },
  ];

  grid.innerHTML = agentList.map(({ key, name, emoji }) => {
    const a = (agents || {})[key] || {};
    const pct = a.contextPct ?? 0;
    const barColor = ctxColor(pct);

    let statusClass = 'agent-idle', badgeClass = 'badge-idle', statusLabel = 'Idle';
    if (a.rateLimit) { statusClass='agent-offline'; badgeClass='badge-ratelimited'; statusLabel='Rate Limited'; }
    else if (a.status === 'active') { statusClass='agent-active'; badgeClass='badge-active'; statusLabel='Active'; }
    else if (a.status === 'offline') { statusClass='agent-offline'; badgeClass='badge-offline'; statusLabel='Offline'; }
    else if (a.status === 'ssh-only') { statusClass='agent-idle'; badgeClass='badge-ssh'; statusLabel='SSH only'; }
    else if (a.status === 'online') { statusClass='agent-idle'; badgeClass='badge-idle'; statusLabel='Online'; }

    const lastActText = a.lastActivityMin != null
      ? (a.lastActivityMin < 1 ? 'just now' : a.lastActivityMin + 'm ago')
      : 'â€”';
    const sessionText = fmtDuration(a.sessionDurationMin);

    return `
      <div class="agent-card ${statusClass}">
        <div class="agent-header">
          <div class="agent-emoji">${emoji}</div>
          <div class="agent-name-block">
            <div class="agent-name">${name}</div>
            <div class="agent-model">${escHTML(a.model || 'claude-sonnet-4-6')}</div>
          </div>
          <div class="agent-status-badge ${badgeClass}">${statusLabel}</div>
        </div>

        <div class="agent-working-on">
          <div class="agent-working-label">Working on</div>
          <div class="agent-working-text">${escHTML(a.workingOn || 'idle')}</div>
        </div>

        <div class="context-bar-wrap">
          <div class="context-bar-header">
            <span class="context-bar-label">Context used</span>
            <span class="context-bar-pct" style="color:${barColor}">${pct}%</span>
          </div>
          <div class="context-bar-bg">
            <div class="context-bar-fill" style="width:${pct}%;background:${barColor}"></div>
          </div>
        </div>

        <div class="agent-stats">
          <div class="agent-stat">
            <div class="agent-stat-label">Session</div>
            <div class="agent-stat-val ${sessionText==='â€”'?'muted':''}">${sessionText}</div>
          </div>
          <div class="agent-stat">
            <div class="agent-stat-label">Last active</div>
            <div class="agent-stat-val ${lastActText==='â€”'?'muted':''}">${lastActText}</div>
          </div>
        </div>
      </div>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER â€” INTEL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderIntel(items) {
  const list = document.getElementById('intel-list');
  if (!items || !items.length) {
    list.innerHTML = '<div style="color:var(--dim);font-size:13px;padding:20px 0">No intel available</div>';
    return;
  }
  list.innerHTML = items.map(item => `
    <div class="intel-item">
      <div class="intel-dot"></div>
      <div>
        <div>${escHTML(item.text || item)}</div>
        ${item.time ? `<div class="intel-time">${timeAgo(item.time)}</div>` : ''}
      </div>
    </div>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER â€” FILES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderFiles(files) {
  const grid = document.getElementById('files-grid');
  if (!files || !files.length) {
    grid.innerHTML = '<div style="color:var(--dim);font-size:13px;padding:20px 0">No files available</div>';
    return;
  }
  grid.innerHTML = files.map(f => `
    <div class="file-card" onclick="openFileModal(${safeJSON(f)})">
      <div class="file-card-header">
        <span class="file-icon">${escHTML(f.icon || 'ğŸ“„')}</span>
        <span class="file-name">${escHTML(f.name)}</span>
      </div>
      <div class="file-preview">${escHTML(f.preview || '')}</div>
      <div class="file-path">${escHTML(f.path || '')}</div>
    </div>`).join('');
}

function openFileModal(f) {
  const md = f.content || f.preview || '';
  openModal((f.icon||'ğŸ“„') + ' ' + f.name, `
    <div class="md-content">
      ${typeof marked !== 'undefined' ? marked.parse(md) : '<pre>' + escHTML(md) + '</pre>'}
    </div>`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER â€” CRON FOOTER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let cronFooterOpen = false;

function toggleCronFooter() {
  cronFooterOpen = !cronFooterOpen;
  document.getElementById('cron-footer-body').classList.toggle('open', cronFooterOpen);
  document.getElementById('cron-chevron').textContent = cronFooterOpen ? 'â–´' : 'â–¾';
}

function renderCronFooter(health) {
  const crons = health?.crons || {};
  const ok = crons.healthy ?? 0;
  const err = crons.errors ?? 0;
  const sum = err > 0
    ? `<span style="color:var(--red)">${err} error${err!==1?'s':''}</span> Â· ${ok} healthy`
    : `<span style="color:var(--green)">${ok} healthy</span>`;
  document.getElementById('cron-footer-summary').innerHTML = sum;
  document.getElementById('cron-footer-body').innerHTML = `
    <span>Crons: ${ok} healthy, ${err} errors</span>
    <span>Last heartbeat: ${timeAgo(health?.lastHeartbeat)}</span>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILITY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function escHTML(str) {
  return String(str||'')
    .replace(/&/g,'&amp;').replace(/</g,'&lt;')
    .replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

function safeJSON(obj) {
  return JSON.stringify(obj).replace(/"/g,'&quot;').replace(/'/g,'&#39;');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA LOADING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadData() {
  try {
    const res = await fetch('data.json?_=' + Date.now());
    if (!res.ok) throw new Error('HTTP ' + res.status);
    const data = await res.json();

    // Timestamp
    const ago = timeAgo(data.updatedAt);
    document.getElementById('sidebar-updated').textContent = ago;

    // Render sections
    renderProjects(data.projects || [], data.needsWjp || []);
    renderAgents(data.agents || {});
    renderIntel(data.intel || []);
    renderFiles(data.files || []);
    renderCronFooter(data.health || {});

  } catch (err) {
    console.error('MC load error:', err);
    document.getElementById('sidebar-updated').textContent = 'Load failed';
  }
}

loadData();
setInterval(loadData, 30000); // 30s refresh
</script>
</body>
</html>
